<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Ebola | Basic Form</title>

    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="css/plugins/iCheck/custom.css" rel="stylesheet">
    <link href="css/plugins/chosen/chosen.css" rel="stylesheet">
    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

</head>

<body>

    <div id="wrapper">


        <div id="page-wrapper" class="gray-bg">
            <div class="row wrapper border-bottom white-bg page-heading">
                <div class="col-lg-10">
                    <h2>Basic Form</h2>
                    <ol class="breadcrumb">
                        <li>
                            <a href="index.html">Home</a>
                        </li>
                        <li>
                            <a>Forms</a>
                        </li>
                        <li class="active">
                            <strong>Basic Form</strong>
                        </li>
                    </ol>
                </div>
                <div class="col-lg-2">

                </div>
            </div>
        <div class="wrapper wrapper-content animated fadeInRight">

            <div id="log-in-row" class="row">
                <div class="col-lg-5">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>Log in</h5>
                            <div class="ibox-tools">
                                <a id="log-in-collapse" class="collapse-link">
                                    <i class="fa fa-chevron-up"></i>
                                </a>
                                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                    <i class="fa fa-wrench"></i>
                                </a>
                                <a class="close-link">
                                    <i class="fa fa-times"></i>
                                </a>
                            </div>
                        </div>
                        <div class="ibox-content">
                            <form class="form-horizontal">
                                <div id="log-in-message">
                                  <p>Please introduce your credentials.</p>
                                </div>
                                <div class="form-group"><label class="col-lg-2 control-label">Email</label>
                                    <div class="col-lg-10"><input id="username" type="email" placeholder="Email" class="form-control"></input>
                                    </div>
                                </div>
                                <div class="form-group"><label class="col-lg-2 control-label">Password</label>
                                    <div class="col-lg-10"><input id="password" type="password" placeholder="Password" class="form-control"></input></div>
                                </div>
                                <div class="form-group">
                                    <div class="col-lg-offset-2 col-lg-10">
                                        <button class="btn btn-sm btn-white" type="button" id="log-in">Sign in</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <div id="form" class="row">
                <div class="col-lg-8">
                  <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>Manage apps</h5>

                        <div class="ibox-tools">
                            <a id="form-collapse" class="collapse-link">
                                <i class="fa fa-chevron-up"></i>
                            </a>
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                <i class="fa fa-wrench"></i>
                            </a>
                            <a class="close-link">
                                <i class="fa fa-times"></i>
                            </a>
                        </div>
                    </div>
                    <div class="ibox-content">

                        <h5>Choose an application from the list</h5>
                        <select id="select-apps" data-placeholder="Choose an app..." class="chosen-select" style="width:350px;" tabindex="2">
                          <option value="">Select</option>
                        </select>

                        <h5></br>Modify the total number of accumulated downloads</h5>
                        <table class="table">
                            <tbody>
                            <tr>
                                <td>i-th day:</td>
                                <td><input id="ith1" class="form-control" style="min-width:40px"></input></td>
                                <td><input id="ith2" class="form-control" style="min-width:40px"></input></td>
                                <td><input id="ith3" class="form-control" style="min-width:40px"></input></td>
                                <td><input id="ith4" class="form-control" style="min-width:40px"></input></td>
                                <td><input id="ith5" class="form-control" style="min-width:40px"></input></td>
                                <td><input id="ith6" class="form-control" style="min-width:40px"></input></td>
                                <td><input id="ith7" class="form-control" style="min-width:40px"></input></td>
                                <td><input id="ith8" class="form-control" style="min-width:40px"></input></td>
                            </tr>
                            <tr>
                              <td># of downloads:</td>
                              <td><input id="num1" class="form-control"></input></td>
                              <td><input id="num2" class="form-control"></input></td>
                              <td><input id="num3" class="form-control"></input></td>
                              <td><input id="num4" class="form-control"></input></td>
                              <td><input id="num5" class="form-control"></input></td>
                              <td><input id="num6" class="form-control"></input></td>
                              <td><input id="num7" class="form-control"></input></td>
                              <td><input id="num8" class="form-control"></input></td>
                            </tr>
                            </tbody>
                        </table>
                        <form class="form-horizontal">
                          <div class="form-group">
                            <div class="col-lg-offset-0 col-lg-10">
                              <button class="btn btn-sm btn-white" type="button" id="submit-data">Submit data</button>
                            </div>
                          </div>
                        </form>

                        <h5></br>Get real data to predict</h5>
                        <form class="form-horizontal">
                          <div class="form-group">
                            <div class="col-lg-offset-0 col-lg-10">
                              <button class="btn btn-sm btn-white" type="button" id="get-real-data">Get real data</button>
                            </div>
                          </div>
                        </form>

                    </div>
                </div>
              </div>
            </div>

            <div id="chart" class="row">
              <div class="col-lg-8">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>Chart</h5>
                        <div class="ibox-tools">
                            <a id="chart-collapse" class="collapse-link">
                                <i class="fa fa-chevron-up"></i>
                            </a>
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                <i class="fa fa-wrench"></i>
                            </a>
                            <a class="close-link">
                                <i class="fa fa-times"></i>
                            </a>
                        </div>
                    </div>
                    <div id="high-charts-container-parent" class="ibox-content">
                      <!--  div id="high-charts-container" style="min-width: 675px; height: 400px; margin: 0 auto"></div>-->
                      <div id="high-charts-container" style="width: 1000px; height: 400px; margin: 0 auto"></div>

                    </div>
                </div>
              </div>
            </div>

        <div class="footer">
            <div class="pull-right">
                10GB of <strong>250GB</strong> Free.
            </div>
            <div>
                <strong>Copyright</strong> Example Company &copy; 2014-2015
            </div>
        </div>

        </div>
        </div>
    </div>


    <!-- Mainly scripts -->
    <script src="js/jquery-2.1.1.js"></script>
    <script src="js/bootstrap.js"></script>
    <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

    <!-- Custom and plugin javascript -->
    <script src="js/inspinia.js"></script>
    <script src="js/plugins/pace/pace.min.js"></script>

    <!-- Chosen -->
    <script src="js/plugins/chosen/chosen.jquery.js"></script>
    <script>
      $(document).ready(function () {
        var config = {
                '.chosen-select'           : {},
                '.chosen-select-deselect'  : {allow_single_deselect:true},
                '.chosen-select-no-single' : {disable_search_threshold:10},
                '.chosen-select-no-results': {no_results_text:'Oops, nothing found!'},
                '.chosen-select-width'     : {width:"95%"}
        }
        for (var selector in config) {
            $(selector).chosen(config[selector]);
        }
      });
    </script>

    <!-- iCheck -->
    <script src="js/plugins/iCheck/icheck.min.js"></script>
    <script>
      $(document).ready(function () {
        $('.i-checks').iCheck({
          checkboxClass: 'icheckbox_square-green',
          radioClass: 'iradio_square-green',
        });
      });
    </script>

    <!-- ebola button controllers -->
    <script>
      $(document).ready(function(){

        document.getElementById("form-collapse").click();
        document.getElementById("chart-collapse").click();

        var chart_is_collapsed = true;

        // when app is selected from combo, puts data into table
        // TODO there must be a way to improve this code !!!
        var set_data_into_table = function(data) {
          if (data.iths[0]) {
            document.getElementById('ith1').value = data.iths[0];
            document.getElementById('num1').value = data.nums[0];
          } else {
            document.getElementById('ith1').value = null;
            document.getElementById('num1').value = null;
          }
          if (data.iths[1]) {
            document.getElementById('ith2').value = data.iths[1];
            document.getElementById('num2').value = data.nums[1];
          } else {
            document.getElementById('ith2').value = null;
            document.getElementById('num2').value = null;
          }
          if (data.iths[2]) {
            document.getElementById('ith3').value = data.iths[2];
            document.getElementById('num3').value = data.nums[2];
          } else {
            document.getElementById('ith3').value = null;
            document.getElementById('num3').value = null;
          }
          if (data.iths[3]) {
            document.getElementById('ith4').value = data.iths[3];
            document.getElementById('num4').value = data.nums[3];
          } else {
            document.getElementById('ith4').value = null;
            document.getElementById('num4').value = null;
          }
          if (data.iths[4]) {
            document.getElementById('ith5').value = data.iths[4];
            document.getElementById('num5').value = data.nums[4];
          } else {
            document.getElementById('ith5').value = null;
            document.getElementById('num5').value = null;
          }
          if (data.iths[5]) {
            document.getElementById('ith6').value = data.iths[5];
            document.getElementById('num6').value = data.nums[5];
          } else {
            document.getElementById('ith6').value = null;
            document.getElementById('num6').value = null;
          }
          if (data.iths[6]) {
            document.getElementById('ith7').value = data.iths[6];
            document.getElementById('num7').value = data.nums[6];
          } else {
            document.getElementById('ith7').value = null;
            document.getElementById('num7').value = null;
          }
          if (data.iths[7]) {
            document.getElementById('ith8').value = data.iths[7];
            document.getElementById('num8').value = data.nums[7];
          } else {
            document.getElementById('ith8').value = null;
            document.getElementById('num8').value = null;
          }
        };

        // Combo controller (after selection of app)
        var selected_app_controller = function () {
          var app_name = select.options[select.selectedIndex].text;
          $.ajax({
            url: 'http://localhost:8080/ebola-jersey-server/webapi/data-from-app',
            type: 'PUT',
            data: JSON.stringify(app_name),
            contentType: 'application/json',
            headers: {
              "Authorization": 'Basic ' + auth
              //"Origin": "http://www.sisifo.com",
              //"Access-Control-Request-Method" : "PUT",
              //"Access-Control-Request-Headers" : "Authorization"
            },
            complete: function(e, xhr, settings){
              if (e.status == 200) {
              } else if (e.status === 401){
                var element = document.getElementById("log-in-message");
                element.innerHTML = "<p>Wrong user id or password</p>";
                element.style.backgroundColor = 'yellow'
              } else if (e.status === 500){
                var element = document.getElementById("log-in-message");
                element.innerHTML = "<p>Fatal error in server</p>";
                element.style.backgroundColor = "rgb(200, 0, 20)"
              } else {
                var element = document.getElementById("log-in-message");
                element.innerHTML = "<p>Unexpected fatal error. Is server up?</p>";
                element.style.backgroundColor = "rgb(200, 0, 20)"
              }
            },
            success: function(data, textStatus, jqXHR) {
              var chart = ChartSingleton.getInstance();
              if (data.chart.ranges) {
                chart.set_ranges(data.chart.ranges);
                chart.set_averages(data.chart.averages);
                chart.set_scatter_data(data.dataTable);
                set_data_into_table(data.dataTable);
                chart.update();
                if (chart_is_collapsed) {
                  document.getElementById("chart-collapse").click();
                  chart_is_collapsed = false;
                }
                document.getElementById("chart").focus()
              } else {
                console.log("Error in response from server. No data.ranges")
              }
            }
          });
        }

        // Login button controller
        $('#log-in').click(function(){
          auth = btoa(document.getElementById('username').value + ':' + document.getElementById('password').value);
          $.ajax({
            url: 'http://localhost:8080/ebola-jersey-server/webapi/login',
            type: 'GET',
            headers: {
              "Authorization": 'Basic ' + auth
              //"Origin": "http://www.sisifo.com",
              //"Access-Control-Request-Method" : "GET",
              //"Access-Control-Request-Headers" : "Authorization"
            },
            complete: function(e, xhr, settings){
              if (e.status == 200) {
              } else if (e.status === 401){
                var element = document.getElementById("log-in-message");
                element.innerHTML = "<p>Wrong user id or password</p>";
                element.style.backgroundColor = 'yellow'
              } else if (e.status === 500){
                var element = document.getElementById("log-in-message");
                element.innerHTML = "<p>Fatal error in server</p>";
                element.style.backgroundColor = "rgb(200, 0, 20)"
              } else {
                var element = document.getElementById("log-in-message");
                element.innerHTML = "<p>Unexpected fatal error. Is server up?</p>";
                element.style.backgroundColor = "rgb(200, 0, 20)"
              }
            },
            success: function(data, textStatus, jqXHR) {
              select = document.getElementById("select-apps");

              // add elements to select
              // TODO old elements should be removed!
              var arrayLength = data.apps.length;
              for (var i=0; i < arrayLength; i++) {
                opt = document.createElement("option");
                opt.value = data.apps[i];
                opt.text = data.apps[i];
                select.appendChild(opt);
              }

              $(select).trigger("chosen:updated");

              // controller for the combo => fetches new data
              $(select).chosen().change(selected_app_controller);

              document.getElementById("log-in-collapse").click();
              document.getElementById("form-collapse").click();

            }
          });
        });

        // Submit data controller
        $('#submit-data').click(function(){
          ith1 = document.getElementById('ith1').value
          ith2 = document.getElementById('ith2').value
          ith3 = document.getElementById('ith3').value
          ith4 = document.getElementById('ith4').value
          ith5 = document.getElementById('ith5').value
          ith6 = document.getElementById('ith6').value
          ith7 = document.getElementById('ith7').value
          ith8 = document.getElementById('ith8').value
          num1 = document.getElementById('num1').value
          num2 = document.getElementById('num2').value
          num3 = document.getElementById('num3').value
          num4 = document.getElementById('num4').value
          num5 = document.getElementById('num5').value
          num6 = document.getElementById('num6').value
          num7 = document.getElementById('num7').value
          num8 = document.getElementById('num8').value
          input_data = {
            "iths" : [
              //{"1": ith1, "2": ith2, "3": ith3, "4": ith4, "5": ith5, "6": ith6, "7": ith7, "8": ith8}
              ith1, ith2, ith3, ith4, ith5, ith6, ith7, ith8
            ],
            "nums" : [
              //{"1": num1, "2": num2, "3": num3, "4": num4, "5": num5, "6": num6, "7": num7, "8": num8}
              num1, num2, num3, num4, num5, num6, num7, num8
            ],
            "appName":  select.options[select.selectedIndex].text
          }
          $.ajax({
            url: 'http://localhost:8080/ebola-jersey-server/webapi/submit-data',
            type: 'PUT',
            data: JSON.stringify(input_data),
            contentType: 'application/json',
            headers: {
              "Authorization": 'Basic ' + auth
              //"Origin": "http://www.sisifo.com",
              //"Access-Control-Request-Method" : "PUT",
              //"Access-Control-Request-Headers" : "Authorization"
            },
            complete: function(e, xhr, settings){
              if (e.status == 200) {
              } else if (e.status === 401){
                var element = document.getElementById("log-in-message");
                element.innerHTML = "<p>Wrong user id or password</p>";
                element.style.backgroundColor = 'yellow'
              } else if (e.status === 500){
                var element = document.getElementById("log-in-message");
                element.innerHTML = "<p>Fatal error in server</p>";
                element.style.backgroundColor = "rgb(200, 0, 20)"
              } else {
                var element = document.getElementById("log-in-message");
                element.innerHTML = "<p>Unexpected fatal error. Is server up?</p>";
                element.style.backgroundColor = "rgb(200, 0, 20)"
              }
            },
            success: function(data, textStatus, jqXHR) {
              var chart = ChartSingleton.getInstance();
              if (data.ranges) {
                chart.set_ranges(data.ranges);
                chart.set_averages(data.averages);
                chart.set_scatter_data(input_data)
                chart.update();
                if (chart_is_collapsed) {
                  document.getElementById("chart-collapse").click();
                  chart_is_collapsed = false;
                }
                document.getElementById("chart").focus()
              } else {
                console.log("Error in response from server. No data.ranges")
              }
            }
          });
        });

        // Get real data controller
        $('#get-real-data').click(function () {
          var app_name = select.options[select.selectedIndex].text;
          $.ajax({
            url: 'http://localhost:8080/ebola-jersey-server/webapi/get-real-data',
            type: 'PUT',
            data: JSON.stringify(app_name),
            contentType: 'application/json',
            headers: {
              "Authorization": 'Basic ' + auth
              //"Origin": "http://www.sisifo.com",
              //"Access-Control-Request-Method" : "PUT",
              //"Access-Control-Request-Headers" : "Authorization"
            },
            complete: function(e, xhr, settings){
              if (e.status == 200) {
              } else if (e.status === 401){
                var element = document.getElementById("log-in-message");
                element.innerHTML = "<p>Wrong user id or password</p>";
                element.style.backgroundColor = 'yellow'
              } else if (e.status === 500){
                var element = document.getElementById("log-in-message");
                element.innerHTML = "<p>Fatal error in server</p>";
                element.style.backgroundColor = "rgb(200, 0, 20)"
              } else {
                var element = document.getElementById("log-in-message");
                element.innerHTML = "<p>Unexpected fatal error. Is server up?</p>";
                element.style.backgroundColor = "rgb(200, 0, 20)"
              }
            },
            success: function(data, textStatus, jqXHR) {
              var chart = ChartSingleton.getInstance();
              if (data.iths) {
                chart.set_scatter_data_real(data);
                chart.update();
                if (chart_is_collapsed) {
                  document.getElementById("chart-collapse").click();
                  chart_is_collapsed = false;
                }
                document.getElementById("chart").focus()
              } else {
                console.log("Error in response from server. No data.iths")
              }
            }
          });
        });

      });
    </script>

    <!-- highcharts -->
    <script src="js/highcharts/highcharts.js"></script>
    <script src="js/highcharts/highcharts-more.js"></script>
    <script src="js/highcharts/exporting.js"></script>
    <script>
      var ChartSingleton = (function () {

        var instance;

        function init() {

          return {
            // public methods and variables
            ranges: get_default_ranges(),
            averages: get_default_averages(),
            scatter_data: get_default_scatter_data(),
            scatter_data_real: null,
            update: function () {
              //$("#high-charts-container").remove();
              //$("#high-charts-container-parent").append('<div id="high-charts-container" style="min-width: 675px; height: 400px; margin: 0 auto"></div>')
              chart_update();
            },
            set_ranges: function(ranges) {
              this.ranges = [];
              var arrayLength = ranges.length;
              for (var i=0; i < arrayLength; i++) {
                this.ranges.push(ranges[i].items);
              }
            },
            set_averages: function(averages) {
              this.averages = [];
              var arrayLength = averages.length;
              for (var i=0; i < arrayLength; i++) {
                this.averages.push(averages[i].items);
              }
            },
            set_scatter_data: function(data) {
              this.scatter_data = [];
              var arrayLength = data.iths.length;
              for (var i=0; i < arrayLength; i++) {
                if (data.iths[i] == "") {
                  break;
                }
                item = new Array(parseInt(data.iths[i]), parseInt(data.nums[i]));
                this.scatter_data.push(item)
              }
            },
            set_scatter_data_real: function(data) {
              this.scatter_data_real = [];
              var arrayLength = data.iths.length;
              for (var i=0; i < arrayLength; i++) {
                if (data.iths[i] == "") {
                  break;
                }
                item = new Array(parseInt(data.iths[i]), parseInt(data.nums[i]));
                this.scatter_data_real.push(item)
              }
            }
          };

        };

        return {

          getInstance: function () {
            if ( !instance ) {
              instance = init();
            }
            return instance;
          }

        };
      })();

      get_default_ranges = function() {
        return [
            [1246406400000, 14.3, 27.7],
            [1246492800000, 14.5, 27.8],
            [1246579200000, 15.5, 29.6],
            [1246665600000, 16.7, 30.7],
            [1246752000000, 16.5, 25.0],
            [1246838400000, 17.8, 25.7],
            [1246924800000, 13.5, 24.8],
            [1247011200000, 10.5, 21.4],
            [1247097600000, 9.2, 23.8],
            [1247184000000, 11.6, 21.8],
            [1247270400000, 10.7, 23.7],
            [1247356800000, 11.0, 23.3],
            [1247443200000, 11.6, 23.7],
            [1247529600000, 11.8, 20.7],
            [1247616000000, 12.6, 22.4],
            [1247702400000, 13.6, 19.6],
            [1247788800000, 11.4, 22.6],
            [1247875200000, 13.2, 25.0],
            [1247961600000, 14.2, 21.6],
            [1248048000000, 13.1, 17.1],
            [1248134400000, 12.2, 15.5],
            [1248220800000, 12.0, 20.8],
            [1248307200000, 12.0, 17.1],
            [1248393600000, 12.7, 18.3],
            [1248480000000, 12.4, 19.4],
            [1248566400000, 12.6, 19.9],
            [1248652800000, 11.9, 20.2],
            [1248739200000, 11.0, 19.3],
            [1248825600000, 10.8, 17.8],
            [1248912000000, 11.8, 18.5],
            [1248998400000, 10.8, 16.1]
        ]
      };

      get_default_averages = function () {
        return [
            [1246406400000, 21.5],
            [1246492800000, 22.1],
            [1246579200000, 23],
            [1246665600000, 23.8],
            [1246752000000, 21.4],
            [1246838400000, 21.3],
            [1246924800000, 18.3],
            [1247011200000, 15.4],
            [1247097600000, 16.4],
            [1247184000000, 17.7],
            [1247270400000, 17.5],
            [1247356800000, 17.6],
            [1247443200000, 17.7],
            [1247529600000, 16.8],
            [1247616000000, 17.7],
            [1247702400000, 16.3],
            [1247788800000, 17.8],
            [1247875200000, 18.1],
            [1247961600000, 17.2],
            [1248048000000, 14.4],
            [1248134400000, 13.7],
            [1248220800000, 15.7],
            [1248307200000, 14.6],
            [1248393600000, 15.3],
            [1248480000000, 15.3],
            [1248566400000, 15.8],
            [1248652800000, 15.2],
            [1248739200000, 14.8],
            [1248825600000, 14.4],
            [1248912000000, 15],
            [1248998400000, 13.6]
        ]
      };

      get_default_scatter_data = function() {
        return [
          [1, 7.0],
          [2, 6.9],
          [4, 14.5],
          [7, 25.2]
        ]
      };

      var chart_update = (function () {

          var chart = ChartSingleton.getInstance();
          var ranges = chart.ranges,
              averages = chart.averages,
              scatter_data = chart.scatter_data,
              scatter_data_real = chart.scatter_data_real;


          $('#high-charts-container').highcharts({

              title: {
                  text: 'Number of downloads versus time'
              },

              xAxis: {
                  type: 'integer'
              },

              yAxis: {
                  title: {
                      text: null
                  }
              },

              tooltip: {
                  crosshairs: true,
                  shared: true,
                  valueSuffix: ''
              },

              legend: {
              },

              series: [{
                  name: '# of downloads',
                  data: averages,
                  zIndex: 1,
                  marker: {
                      fillColor: 'white',
                      lineWidth: 2,
                      lineColor: Highcharts.getOptions().colors[0]
                  }
              }, {
                  name: 'Range',
                  data: ranges,
                  type: 'arearange',
                  lineWidth: 0,
                  linkedTo: ':previous',
                  color: Highcharts.getOptions().colors[0],
                  fillOpacity: 0.3,
                  zIndex: 0
              }, {
                  name: 'data',
                  type: 'scatter',
                  color: Highcharts.getOptions().colors[4],
                  marker: {
                    radius: 5
                  },
                  data: scatter_data
              }, {
                  name: 'data to predict',
                  type: 'scatter',
                  color: Highcharts.getOptions().colors[3],
                  marker: {
                    radius: 5
                  },
                  data: scatter_data_real
              }]
          });
      });
    </script>
</body>

</html>
